<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CanX</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}" />
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/logo.png') }}" />
    <link rel="stylesheet" href="/static/css/styles.css" />
    <link rel="stylesheet" href="/static/css/graphic.css" />
  </head>
  <body>
    <header>
      <div class="header-top">
        <a class="home-btn" href="/" aria-label="CanX home">
          <img src="{{ url_for('static', filename='img/logo.png') }}" alt="CanX logo" />
          <span>CanX</span>
        </a>
      </div>
      <div class="init-form">
        <select id="device">
          <option value="PCAN">PCAN</option>
          <option value="CANalyzer">CANalyzer</option>
          <option value="CANoe">CANoe</option>
          <option value="CANape">CANape</option>
          <option value="VirtualCAN">VirtualCAN</option>
          <option value="MockCAN">MockCAN</option>
        </select>
        <label>Channel <input id="channel" type="number" value="0" min="0" /></label>
        <label>CAN FD <input id="is_fd" type="checkbox" /></label>
        <label>Padding <input id="padding" type="text" value="00" size="3" /></label>
        <div class="dbc-picker">
          <label>DBC <input id="dbc_path" type="text" placeholder="path/to/file.dbc" size="28" /></label>
          <button id="btn-dbc-browse" type="button">Browse…</button>
          <input id="dbc-file" type="file" accept=".dbc" hidden />
        </div>
        <div class="init-actions">
          <button id="btn-connection-toggle" type="button" aria-pressed="false">Connect</button>
          <button id="btn-reset-signals" type="button" disabled>Initialize</button>
          <button id="btn-log-toggle" type="button" aria-pressed="false">Start Log</button>
        </div>
        <span id="init-status" class="init-status" role="status" aria-live="polite"></span>
      </div>
      <nav>
        <button class="tab-btn active" data-tab="trace">Trace</button>
        <button class="tab-btn" data-tab="log">Log</button>
        <button class="tab-btn" data-tab="messages">Messages</button>
        <button class="tab-btn" data-tab="stim">Stimulation</button>
        <button class="tab-btn" data-tab="diag">Diagnostics</button>
        <button class="tab-btn" data-tab="graphic">Graphic</button>
        <button class="tab-btn" data-tab="panel">Panel</button>
      </nav>
      <div id="socket-status" class="app-status" role="alert" hidden></div>
    </header>

    <main>
      <section id="tab-trace" class="tab active">
        <div class="toolbar">
          <button id="btn-trace-clear" type="button">Clear Trace</button>
          <label>Filter ID <input id="trace-filter" type="text" placeholder="e.g. 7E0 or 0x7E0" /></label>
          <span id="trace-status" class="status" role="status" aria-live="polite"></span>
        </div>
        <table id="trace-table">
          <thead>
            <tr>
              <th>Δt (s)</th>
              <th>Direction</th>
              <th>Frame</th>
              <th>ID</th>
              <th>Frame Name</th>
              <th>DLC</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="tab-log" class="tab">
        <div class="toolbar">
          <button id="btn-log-clear" type="button">Clear Log</button>
          <label>Filter ID <input id="log-filter" type="text" placeholder="e.g. 7E0 or 0x7E0" /></label>
          <span id="log-status" class="status" role="status" aria-live="polite"></span>
        </div>
        <table id="log-table">
          <thead>
            <tr>
              <th>Time (s)</th>
              <th>Direction</th>
              <th>Frame</th>
              <th>ID</th>
              <th>Frame Name</th>
              <th>DLC</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="tab-messages" class="tab">
        <div class="split">
          <div class="left">
            <div class="toolbar">
              <button id="btn-load-dbc">Load DBC Messages</button>
              <input id="msg-search" type="text" placeholder="Search message" />
            </div>
            <ul id="msg-list"></ul>
          </div>
          <div class="right">
            <div id="msg-details">
              <h3 id="msg-title">Select a message</h3>
              <div class="toolbar">
                <label>Period (ms) <input id="msg-period" type="number" value="100" /></label>
                <label>Duration (ms) <input id="msg-duration" type="number" placeholder="(optional)" /></label>
                <button id="btn-update-signals">Update</button>
                <button id="btn-toggle-periodic" class="toggle-btn">Activate</button>
                <button id="btn-remove-message">Remove</button>
                <span id="msg-status" class="stim-status"></span>
              </div>
              <form id="signals-form"></form>
              <div id="msg-meta"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-stim" class="tab">
        <div class="toolbar">
          <select id="stim-node-select"></select>
          <button id="btn-stim-add">Add Node</button>
          <span id="stim-status"></span>
        </div>
        <div id="stim-nodes-container"></div>
      </section>

      <section id="tab-diag" class="tab">
        <div class="toolbar diag-toolbar">
          <label>ECU ID <input id="ecu-id" type="text" value="7E0" /></label>
          <label>Tester ID <input id="tester-id" type="text" value="7E8" /></label>
          <div class="diag-dll-picker">
            <label>Security DLL <input id="diag-dll" type="text" placeholder="path/to/security.dll" size="28" /></label>
            <button id="btn-dll-browse" type="button">Browse…</button>
            <input id="diag-dll-file" type="file" accept=".dll" hidden />
          </div>
          <button id="btn-diag-config">Configure</button>
        </div>

        <div class="diag-columns">
          <div class="diag-pane" data-group="functional">
            <div class="toolbar diag-toolbar" data-group="functional">
              <label>Functional Request (HEX)
                <textarea id="diag-functional-raw" rows="2" wrap="soft" placeholder="e.g. 10 01"></textarea>
              </label>
              <label>Target ID <input id="diag-functional-id" type="text" value="7DF" /></label>
              <label>Timeout (ms) <input id="diag-functional-timeout" type="number" value="500" /></label>
              <button id="btn-functional-send">Send</button>
              <button id="btn-functional-add" class="diag-add-btn">Add</button>
            </div>
            <div class="diag-custom" id="functional-custom-buttons"></div>
          </div>

          <div class="diag-pane" data-group="physical">
            <div class="toolbar diag-toolbar" data-group="physical">
              <label>Physical Request (HEX)
                <textarea id="diag-physical-raw" rows="2" wrap="soft" placeholder="e.g. 22 F1 90"></textarea>
              </label>
              <label>Target ID <input id="diag-physical-id" type="text" value="7E0" /></label>
              <label>Timeout (ms) <input id="diag-physical-timeout" type="number" value="500" /></label>
              <button id="btn-physical-send">Send</button>
              <button id="btn-physical-add" class="diag-add-btn">Add</button>
            </div>
            <div class="diag-quick-actions">
              <div class="diag-did-row">
                <label class="diag-inline-label" for="diag-physical-did-value">Value (uint8)</label>
                <input id="diag-physical-did-value" type="number" min="0" max="255" value="0" />
                <button id="btn-physical-send-did" type="button">Send DID Value</button>
              </div>
              <div class="diag-static" id="physical-static-buttons"></div>
            </div>
            <div class="diag-custom" id="physical-custom-buttons"></div>
          </div>
        </div>

        <div class="toolbar diag-toolbar">
          <label>Unlock ECU ID <input id="diag-unlock-ecu" type="text" placeholder="(defaults to ECU ID)" /></label>
          <button id="btn-diag-unlock">Unlock Security</button>
          <span id="diag-unlock-status"></span>
        </div>

        <div class="toolbar diag-toolbar">
          <label>Tester Present every <input id="tp-interval" type="number" value="2000" /> ms</label>
          <button id="btn-tp-start">Start</button>
          <button id="btn-tp-stop">Stop</button>
        </div>

        <div class="diag-log" id="diag-log"></div>
      </section>

      <section id="tab-graphic" class="tab">
        <div class="graphic-wrapper">
          <div class="graphic-stage-column">
            <div class="graphic-stage-header">
              <div>
                <h3>Graphic View</h3>
                <div class="graphic-mode-toggle" role="radiogroup" aria-label="Graph style">
                  <label>
                    <input type="radio" name="graphic-mode" value="combined" checked />
                    Combined
                  </label>
                  <label>
                    <input type="radio" name="graphic-mode" value="separate" />
                    Separate
                  </label>
                </div>
              </div>
              <div class="graphic-main-actions">
                <span id="graphic-pause-indicator" class="graphic-pause-indicator" aria-hidden="true">Paused</span>
                <button id="graphic-pause" type="button">Pause</button>
              </div>
            </div>
            <div class="graphic-controls-row">
              <div class="graphic-scale-readout" aria-live="polite">
                <div>
                  <span>Time / div</span>
                  <strong id="graphic-time-scale">—</strong>
                </div>
                <div>
                  <span>Vertical zoom</span>
                  <strong id="graphic-value-scale">—</strong>
                </div>
              </div>
              <div class="graphic-zoom-controls" aria-label="Time axis zoom controls">
                <button id="graphic-zoom-out" type="button" aria-label="Zoom out time axis">−</button>
                <button id="graphic-zoom-in" type="button" aria-label="Zoom in time axis">+</button>
                <button id="graphic-zoom-reset" type="button">Reset</button>
                <button id="graphic-zoom-auto" type="button">Auto</button>
                <div class="graphic-cursor-controls">
                  <button id="graphic-cursor-toggle" type="button" aria-pressed="false">Cursors</button>
                  <span id="graphic-cursor-delta" class="graphic-cursor-delta" aria-live="polite">Δt —</span>
                </div>
              </div>
            </div>
            <div class="graphic-stage" id="graphic-stage">
              <div class="graphic-canvas is-active" id="graphic-combined" aria-label="Signal oscilloscope view">
                <canvas id="graphic-combined-canvas"></canvas>
                <div id="graphic-placeholder" aria-live="polite">Select signals to render them here.</div>
              </div>
              <div id="graphic-separate-container" class="graphic-separate-container"></div>
            </div>
            <p class="graphic-stage-hint">
              Scroll vertically to adjust amplitude, horizontally to change the time base. Drag to pan while paused.
            </p>
          </div>
          <aside class="graphic-sidebar" aria-label="Signal browser and legend">
            <div class="graphic-sidebar-section graphic-search-section">
              <div class="graphic-search-bar">
                <input
                  id="graphic-search"
                  type="text"
                  placeholder="Search signal or message"
                  autocomplete="off"
                />
                <button id="btn-graphic-refresh" type="button">Reload</button>
              </div>
              <ul id="graphic-results" class="graphic-result-list"></ul>
            </div>
            <div class="graphic-sidebar-section graphic-selected-section">
              <h3>Selected Signals</h3>
              <ul id="graphic-selected" class="graphic-selected-list"></ul>
            </div>
            <div id="graphic-status" class="graphic-status" role="status" aria-live="polite"></div>
          </aside>
        </div>
      </section>

      <section id="tab-panel" class="tab">
        <div id="panel-layout">
          <div id="panel-ribbon-stack">
            <div class="panel-ribbon panel-main-ribbon">
              <div class="panel-ribbon-group panel-mode-group">
                <div class="panel-ribbon-button-block">
                  <button id="panel-run-mode" class="panel-ribbon-button panel-ribbon-button--mode" type="button">
                    <span class="panel-ribbon-icon panel-icon-running" aria-hidden="true"></span>
                  </button>
                  <span class="panel-ribbon-label">Running</span>
                </div>
              </div>

              <div class="panel-ribbon-group panel-io-group">
                <div class="panel-ribbon-group-title">Export / Import</div>
                <div class="panel-ribbon-stack-buttons">
                  <div class="panel-ribbon-button-block">
                    <button id="panel-export" class="panel-ribbon-button panel-ribbon-button--export" type="button">
                      <span class="panel-ribbon-icon panel-icon-export" aria-hidden="true"></span>
                    </button>
                    <span class="panel-ribbon-label">Export</span>
                  </div>
                  <div class="panel-ribbon-button-block">
                    <button id="panel-import" class="panel-ribbon-button panel-ribbon-button--import" type="button">
                      <span class="panel-ribbon-icon panel-icon-import" aria-hidden="true"></span>
                    </button>
                    <span class="panel-ribbon-label">Import</span>
                  </div>
                  <input id="panel-import-file" type="file" hidden accept="application/json" />
                </div>
              </div>

              <div class="panel-ribbon-group panel-clear-group" data-mode="edit">
                <div class="panel-ribbon-button-block">
                  <button id="panel-clear" class="panel-ribbon-button" type="button">
                    <span class="panel-ribbon-icon panel-icon-clear" aria-hidden="true"></span>
                  </button>
                  <span class="panel-ribbon-label">Clear All</span>
                </div>
              </div>

              <div class="panel-ribbon-group panel-toolbox-group" data-mode="edit">
                <div class="panel-ribbon-group-title">Toolbox</div>
                <div class="panel-toolbox-dropdown">
                  <div id="panel-toolbox" class="panel-toolbox-menu"></div>
                  <div id="panel-toolbox-description" class="panel-toolbox-description" hidden></div>
                </div>
              </div>

              <div class="panel-ribbon-group panel-name-group">
                <label class="panel-ribbon-field">
                  <span class="panel-ribbon-group-title">Panel Name</span>
                  <input id="panel-name" type="text" placeholder="Untitled panel" />
                </label>
              </div>

              <div class="panel-ribbon-group panel-description-group" data-mode="edit">
                <label class="panel-ribbon-field">
                  <span class="panel-ribbon-group-title">Description</span>
                  <textarea id="panel-description" rows="2" placeholder="Panel description"></textarea>
                </label>
              </div>
            </div>

            <div id="panel-object-ribbon" class="panel-ribbon panel-object-ribbon" hidden>
              <div id="panel-properties"></div>
            </div>
          </div>

          <div id="panel-canvas-container">
            <div id="panel-canvas"></div>
          </div>
        </div>
      </section>
    </main>

    <script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>
    <script type="module" src="/static/js/main.js"></script>
    <script type="module" src="/static/js/panel.js"></script>
  </body>
  </html>
