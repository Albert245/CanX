<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CanX</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}" />
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/logo.png') }}" />
    <link rel="stylesheet" href="/static/css/styles.css" />
  </head>
  <body>
    <header>
      <div class="header-top">
        <a class="home-btn" href="/" aria-label="CanX home">
          <img src="{{ url_for('static', filename='img/logo.png') }}" alt="CanX logo" />
          <span>CanX</span>
        </a>
      </div>
      <div class="init-form">
        <select id="device">
          <option value="PCAN">PCAN</option>
          <option value="CANalyzer">CANalyzer</option>
          <option value="CANoe">CANoe</option>
          <option value="CANape">CANape</option>
          <option value="VirtualCAN">VirtualCAN</option>
          <option value="MockCAN">MockCAN</option>
        </select>
        <label>Channel <input id="channel" type="number" value="0" min="0" /></label>
        <label>CAN FD <input id="is_fd" type="checkbox" /></label>
        <label>Padding <input id="padding" type="text" value="00" size="3" /></label>
        <div class="dbc-picker">
          <label>DBC <input id="dbc_path" type="text" placeholder="path/to/file.dbc" size="28" /></label>
          <button id="btn-dbc-browse" type="button">Browse…</button>
          <input id="dbc-file" type="file" accept=".dbc" hidden />
        </div>
        <button id="btn-init">Init</button>
        <span id="init-status"></span>
      </div>
      <nav>
        <button class="tab-btn active" data-tab="log">Log</button>
        <button class="tab-btn" data-tab="trace">Trace</button>
        <button class="tab-btn" data-tab="messages">Messages</button>
        <button class="tab-btn" data-tab="stim">Stimulation</button>
        <button class="tab-btn" data-tab="diag">Diagnostics</button>
        <button class="tab-btn" data-tab="graphic">Graphic</button>
      </nav>
      <div id="socket-status" class="app-status" role="alert" hidden></div>
    </header>

    <main>
      <section id="tab-log" class="tab active">
        <div class="toolbar">
          <button id="btn-log-toggle" type="button" aria-pressed="false">Start Log</button>
          <button id="btn-log-clear" type="button">Clear Log</button>
          <label>Filter ID <input id="log-filter" type="text" placeholder="e.g. 7E0 or 0x7E0" /></label>
          <span id="log-status" class="status" role="status" aria-live="polite"></span>
        </div>
        <table id="log-table">
          <thead>
            <tr>
              <th>Time (s)</th>
              <th>Direction</th>
              <th>Frame</th>
              <th>ID</th>
              <th>Frame Name</th>
              <th>DLC</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="tab-trace" class="tab">
        <div class="toolbar">
          <button id="btn-trace-clear" type="button">Clear Trace</button>
          <label>Filter ID <input id="trace-filter" type="text" placeholder="e.g. 7E0 or 0x7E0" /></label>
          <span id="trace-status" class="status" role="status" aria-live="polite"></span>
        </div>
        <table id="trace-table">
          <thead>
            <tr>
              <th>Δt (s)</th>
              <th>Direction</th>
              <th>Frame</th>
              <th>ID</th>
              <th>Frame Name</th>
              <th>DLC</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="tab-messages" class="tab">
        <div class="split">
          <div class="left">
            <div class="toolbar">
              <button id="btn-load-dbc">Load DBC Messages</button>
              <input id="msg-search" type="text" placeholder="Search message" />
            </div>
            <ul id="msg-list"></ul>
          </div>
          <div class="right">
            <div id="msg-details">
              <h3 id="msg-title">Select a message</h3>
              <div class="toolbar">
                <label>Period (ms) <input id="msg-period" type="number" value="100" /></label>
                <label>Duration (ms) <input id="msg-duration" type="number" placeholder="(optional)" /></label>
                <button id="btn-start-periodic">Start</button>
                <button id="btn-stop-periodic">Stop</button>
              </div>
              <form id="signals-form"></form>
              <button id="btn-update-signals">Update Signals</button>
              <div id="msg-meta"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-stim" class="tab">
        <div class="toolbar">
          <select id="stim-node-select"></select>
          <button id="btn-stim-add">Add Node</button>
          <span id="stim-status"></span>
        </div>
        <div id="stim-nodes-container"></div>
      </section>

      <section id="tab-diag" class="tab">
        <div class="toolbar diag-toolbar">
          <label>ECU ID <input id="ecu-id" type="text" value="7E0" /></label>
          <label>Tester ID <input id="tester-id" type="text" value="7E8" /></label>
          <div class="diag-dll-picker">
            <label>Security DLL <input id="diag-dll" type="text" placeholder="path/to/security.dll" size="28" /></label>
            <button id="btn-dll-browse" type="button">Browse…</button>
            <input id="diag-dll-file" type="file" accept=".dll" hidden />
          </div>
          <button id="btn-diag-config">Configure</button>
        </div>

        <div class="diag-columns">
          <div class="diag-pane" data-group="functional">
            <div class="toolbar diag-toolbar" data-group="functional">
              <label>Functional Request (HEX)
                <textarea id="diag-functional-raw" rows="2" wrap="soft" placeholder="e.g. 10 01"></textarea>
              </label>
              <label>Target ID <input id="diag-functional-id" type="text" value="7DF" /></label>
              <label>Timeout (ms) <input id="diag-functional-timeout" type="number" value="500" /></label>
              <button id="btn-functional-send">Send</button>
              <button id="btn-functional-add" class="diag-add-btn">Add</button>
            </div>
            <div class="diag-custom" id="functional-custom-buttons"></div>
          </div>

          <div class="diag-pane" data-group="physical">
            <div class="toolbar diag-toolbar" data-group="physical">
              <label>Physical Request (HEX)
                <textarea id="diag-physical-raw" rows="2" wrap="soft" placeholder="e.g. 22 F1 90"></textarea>
              </label>
              <label>Target ID <input id="diag-physical-id" type="text" value="7E0" /></label>
              <label>Timeout (ms) <input id="diag-physical-timeout" type="number" value="500" /></label>
              <button id="btn-physical-send">Send</button>
              <button id="btn-physical-add" class="diag-add-btn">Add</button>
            </div>
            <div class="diag-quick-actions">
              <div class="diag-did-row">
                <label class="diag-inline-label" for="diag-physical-did-value">Value (uint8)</label>
                <input id="diag-physical-did-value" type="number" min="0" max="255" value="0" />
                <button id="btn-physical-send-did" type="button">Send DID Value</button>
              </div>
              <div class="diag-static" id="physical-static-buttons"></div>
            </div>
            <div class="diag-custom" id="physical-custom-buttons"></div>
          </div>
        </div>

        <div class="toolbar diag-toolbar">
          <label>Unlock ECU ID <input id="diag-unlock-ecu" type="text" placeholder="(defaults to ECU ID)" /></label>
          <button id="btn-diag-unlock">Unlock Security</button>
          <span id="diag-unlock-status"></span>
        </div>

        <div class="toolbar diag-toolbar">
          <label>Tester Present every <input id="tp-interval" type="number" value="2000" /> ms</label>
          <button id="btn-tp-start">Start</button>
          <button id="btn-tp-stop">Stop</button>
        </div>

        <div class="diag-log" id="diag-log"></div>
      </section>

      <section id="tab-graphic" class="tab">
        <div class="graphic-wrapper">
          <div class="graphic-sidebar">
            <div class="toolbar">
              <button id="btn-graphic-refresh" type="button">Reload DBC Signals</button>
              <input
                id="graphic-search"
                type="text"
                placeholder="Search signal or message"
                autocomplete="off"
              />
            </div>
            <ul id="graphic-results" class="graphic-result-list"></ul>
          </div>
          <div class="graphic-main">
            <div class="graphic-main-header">
              <h3>Selected Signals</h3>
              <div class="graphic-mode-toggle" role="radiogroup" aria-label="Graph style">
                <label>
                  <input type="radio" name="graphic-mode" value="combined" checked />
                  Combined
                </label>
                <label>
                  <input type="radio" name="graphic-mode" value="separate" />
                  Separate
                </label>
              </div>
            </div>
            <ul id="graphic-selected" class="graphic-selected-list"></ul>
            <div id="graphic-status" class="graphic-status" role="status" aria-live="polite"></div>
            <div class="graphic-canvas" id="graphic-combined-wrapper">
              <canvas id="graphic-combined-canvas"></canvas>
            </div>
            <div id="graphic-separate-container" class="graphic-separate-container"></div>
          </div>
        </div>
      </section>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/static/js/main.js"></script>
  </body>
  </html>
